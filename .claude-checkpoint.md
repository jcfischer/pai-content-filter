# Checkpoint: Issue #6 — Fail-closed with bypass logging

## Task
Change content filter default from fail-open to fail-closed with bypass logging.

## ISC Status
All 8/8 criteria PASSED.

## Files Modified
- `src/lib/types.ts` — Added `content_filter_bypass` to AuditEventType, added ContentFilterBypassEvent interface
- `src/lib/bypass.ts` — NEW: bypassFilter() function with mandatory caller_id and reason
- `src/lib/content-filter.ts` — Wrapped filterContentString in try-catch, returns BLOCKED on error
- `hooks/ContentFilter.hook.ts` — Changed all fail-open exits to fail-closed (exit 2)
- `hooks/SandboxEnforcer.hook.ts` — Changed all fail-open exits to fail-closed (exit 2)
- `src/index.ts` — Added bypassFilter and ContentFilterBypassEvent exports
- `tests/bypass.test.ts` — NEW: 11 tests for bypass function + fail-closed behavior
- `tests/integration/hook.test.ts` — Updated 3 tests from fail-open to fail-closed expectations
- `tests/integration/sandbox-enforcer.test.ts` — Updated 2 tests from fail-open to fail-closed expectations

## Key Decisions
- `maybeLogAudit` stays fail-open (audit logging failure should never block the pipeline)
- Non-gated tools (Write, Edit, Bash) still exit 0 (passthrough, not errors)
- Missing sandbox config still exits 0 (operator choice, not error)
- Paths outside sandbox still exit 0 (correct filtering, not error)

## Test Results
- 492 tests pass, 0 fail
- TypeScript typecheck clean

## Next Steps
- Commit changes
- Update CLAUDE.md test count if needed
